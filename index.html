<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portfolio Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #111827; font-family: system-ui, -apple-system, sans-serif; margin: 0; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4 md:p-6">
  <div id="app" class="max-w-7xl mx-auto"></div>

  <script>
    // ===== PORTFOLIO DATA =====
    const holdings = {
      jp: [
        { t: '6273', n: 'ＳＭＣ', s: 1, c: 65083, p: 61900, ch: -2.52 },
        { t: '6315', n: 'ＴＯＷＡ', s: 5, c: 3062, p: 3090, ch: 2.66 },
        { t: '6954', n: 'ファナック', s: 10, c: 6532, p: 6580, ch: 0.60 },
        { t: '8058', n: '三菱商事', s: 25, c: 4033, p: 4082, ch: 0.89 },
        { t: '8766', n: '東京海上ＨＤ', s: 10, c: 5886, p: 5811, ch: -0.14 },
      ],
      us: [
        { t: 'VWO', n: 'Vanguard EM', s: 20, c: 55.96, p: 56.11, ch: 1.03 },
        { t: 'VOO', n: 'S&P 500', s: 6, c: 618.37, p: 630.29, ch: 1.15 },
        { t: 'HDV', n: 'High Div', s: 5, c: 121.40, p: 127.80, ch: 1.07 },
        { t: 'XLE', n: 'Energy', s: 34, c: 45.16, p: 48.75, ch: 2.42 },
        { t: 'XLU', n: 'Utilities', s: 40, c: 42.78, p: 43.02, ch: 0.14 },
        { t: 'ED', n: 'Con Edison', s: 10, c: 97.91, p: 103.84, ch: -1.15 },
        { t: 'MTZ', n: 'MasTec', s: 4, c: 201.62, p: 243.80, ch: 1.44 },
        { t: 'DUOL', n: 'Duolingo', s: 2, c: 171.63, p: 146.81, ch: -1.19 },
        { t: 'BITF', n: 'Bitfarms', s: 7, c: 0, p: 2.69, ch: 0.75 },
        { t: 'URA', n: 'Uranium', s: 29, c: 50.50, p: 56.15, ch: 3.75 },
        { t: 'IJR', n: 'Small-Cap', s: 15, c: 119.51, p: 130.12, ch: 2.60 },
      ],
      gold: { g: 17.64, cost: 18960, price: 24605 },
      cash: { jpy: 66896, usd: 842.94 },
      mmf: 15966
    };

    const fx = 158.63;

    // ===== CALCULATIONS =====
    function calc() {
      const jpStocks = holdings.jp.map(x => {
        const val = x.p * x.s;
        const cost = x.c * x.s;
        return { ...x, m: 'JP', val, cost, pl: val - cost, plPct: ((val - cost) / cost * 100) };
      });

      const usStocks = holdings.us.map(x => {
        const valUSD = x.p * x.s;
        const val = valUSD * fx;
        const costUSD = x.c * x.s;
        const cost = costUSD * fx;
        const plUSD = valUSD - costUSD;
        return { ...x, m: 'US', val, cost, pl: plUSD * fx, plPct: costUSD > 0 ? (plUSD / costUSD * 100) : 100 };
      });

      const goldVal = holdings.gold.g * holdings.gold.price;
      const goldCost = holdings.gold.g * holdings.gold.cost;
      const cashJPY = holdings.cash.jpy;
      const cashUSD = holdings.cash.usd * fx;

      const jpTotal = jpStocks.reduce((a, x) => a + x.val, 0);
      const usTotal = usStocks.reduce((a, x) => a + x.val, 0);
      const total = jpTotal + usTotal + goldVal + cashJPY + cashUSD + holdings.mmf;

      const allStocks = [...jpStocks, ...usStocks].sort((a, b) => b.val - a.val);
      const gainers = [...allStocks].sort((a, b) => b.ch - a.ch).slice(0, 3);
      const losers = [...allStocks].sort((a, b) => a.ch - b.ch).slice(0, 3);

      const totalPL = jpStocks.reduce((a, x) => a + x.pl, 0) + usStocks.reduce((a, x) => a + x.pl, 0) + (goldVal - goldCost);

      return { allStocks, jpTotal, usTotal, goldVal, goldCost, cashJPY, cashUSD, total, totalPL, gainers, losers };
    }

    // ===== FORMATTING =====
    const fY = v => '¥' + Math.round(v).toLocaleString();
    const fD = v => '$' + v.toFixed(2);
    const fP = v => (v >= 0 ? '+' : '') + v.toFixed(2) + '%';
    const fC = v => (v >= 0 ? '+' : '') + fY(v);

    // ===== RENDER =====
    function render() {
      const d = calc();
      const now = new Date().toLocaleTimeString('ja-JP');

      document.getElementById('app').innerHTML = `
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
          <div>
            <h1 class="text-2xl md:text-3xl font-bold mb-1">Portfolio Dashboard</h1>
            <p class="text-gray-400 text-sm">Updated: ${now} · USD/JPY: ¥${fx.toFixed(2)}</p>
          </div>
          <button onclick="location.reload()" class="mt-3 md:mt-0 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg">↻ Refresh</button>
        </div>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <div class="bg-gray-800 rounded-xl p-4">
            <p class="text-gray-400 text-sm mb-1">総資産 Total</p>
            <p class="text-2xl md:text-3xl font-bold">${fY(d.total)}</p>
          </div>
          <div class="bg-gray-800 rounded-xl p-4">
            <p class="text-gray-400 text-sm mb-1">評価損益 P&L</p>
            <p class="text-2xl md:text-3xl font-bold ${d.totalPL >= 0 ? 'text-green-400' : 'text-red-400'}">${fC(d.totalPL)}</p>
          </div>
          <div class="bg-gray-800 rounded-xl p-4">
            <p class="text-gray-400 text-sm mb-1">国内株式 JP</p>
            <p class="text-2xl md:text-3xl font-bold text-blue-400">${fY(d.jpTotal)}</p>
          </div>
          <div class="bg-gray-800 rounded-xl p-4">
            <p class="text-gray-400 text-sm mb-1">米国株式 US</p>
            <p class="text-2xl md:text-3xl font-bold text-green-400">${fD(d.usTotal / fx)}</p>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="bg-gray-800 rounded-xl p-4">
            <h2 class="text-lg font-semibold mb-4">資産配分 Allocation</h2>
            <div class="space-y-3">
              ${bar('米国株式 US', d.usTotal, d.total, '#10B981')}
              ${bar('国内株式 JP', d.jpTotal, d.total, '#3B82F6')}
              ${bar('金 Gold', d.goldVal, d.total, '#FBBF24')}
              ${bar('現金 Cash', d.cashJPY + d.cashUSD, d.total, '#6B7280')}
              ${bar('MMF', holdings.mmf, d.total, '#84CC16')}
            </div>
          </div>
          <div class="bg-gray-800 rounded-xl p-4">
            <h2 class="text-lg font-semibold mb-4">Today's Movers</h2>
            <p class="text-green-400 font-medium mb-2">↑ Top Gainers</p>
            ${d.gainers.map(x => `<div class="flex justify-between py-1 text-sm"><span>${x.t} <span class="text-gray-500">${x.n}</span></span><span class="text-green-400">${fP(x.ch)}</span></div>`).join('')}
            <p class="text-red-400 font-medium mb-2 mt-4">↓ Top Losers</p>
            ${d.losers.map(x => `<div class="flex justify-between py-1 text-sm"><span>${x.t} <span class="text-gray-500">${x.n}</span></span><span class="text-red-400">${fP(x.ch)}</span></div>`).join('')}
          </div>
        </div>

        <div class="bg-gray-800 rounded-xl p-4 mb-6 overflow-x-auto">
          <h2 class="text-lg font-semibold mb-4">保有銘柄 Holdings</h2>
          <table class="w-full text-sm">
            <thead><tr class="text-gray-400 border-b border-gray-700">
              <th class="text-left py-2">銘柄</th>
              <th class="text-right py-2">数量</th>
              <th class="text-right py-2">価格</th>
              <th class="text-right py-2">前日比</th>
              <th class="text-right py-2">時価</th>
              <th class="text-right py-2">損益</th>
            </tr></thead>
            <tbody>
              ${d.allStocks.map(x => `
                <tr class="border-b border-gray-700/50">
                  <td class="py-2"><span class="text-xs px-1 rounded mr-1 ${x.m === 'JP' ? 'bg-blue-900 text-blue-300' : 'bg-green-900 text-green-300'}">${x.m}</span>${x.t} <span class="text-gray-500 text-xs">${x.n}</span></td>
                  <td class="text-right py-2">${x.s}</td>
                  <td class="text-right py-2">${x.m === 'JP' ? fY(x.p) : fD(x.p)}</td>
                  <td class="text-right py-2 ${x.ch >= 0 ? 'text-green-400' : 'text-red-400'}">${fP(x.ch)}</td>
                  <td class="text-right py-2">${fY(x.val)}</td>
                  <td class="text-right py-2 ${x.pl >= 0 ? 'text-green-400' : 'text-red-400'}">${fC(x.pl)}<br><span class="text-xs">(${fP(x.plPct)})</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>

        <div class="bg-gray-800 rounded-xl p-4">
          <h2 class="text-lg font-semibold mb-4">その他 Other Assets</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-gray-700/50 rounded-lg p-3">
              <p class="text-gray-400 text-sm">金 Gold</p>
              <p class="text-xl font-bold text-yellow-400">${fY(d.goldVal)}</p>
              <p class="text-sm ${d.goldVal - d.goldCost >= 0 ? 'text-green-400' : 'text-red-400'}">${fC(d.goldVal - d.goldCost)}</p>
            </div>
            <div class="bg-gray-700/50 rounded-lg p-3">
              <p class="text-gray-400 text-sm">MMF</p>
              <p class="text-xl font-bold">${fY(holdings.mmf)}</p>
            </div>
            <div class="bg-gray-700/50 rounded-lg p-3">
              <p class="text-gray-400 text-sm">円 JPY</p>
              <p class="text-xl font-bold">${fY(d.cashJPY)}</p>
            </div>
            <div class="bg-gray-700/50 rounded-lg p-3">
              <p class="text-gray-400 text-sm">$ USD</p>
              <p class="text-xl font-bold">${fY(d.cashUSD)}</p>
              <p class="text-sm text-gray-400">${fD(holdings.cash.usd)}</p>
            </div>
          </div>
        </div>
        <p class="text-center text-gray-500 text-sm mt-6">Click Refresh to update · Prices from Rakuten Securities</p>
      `;
    }

    function bar(label, val, total, color) {
      const pct = (val / total * 100).toFixed(1);
      return `<div>
        <div class="flex justify-between text-sm mb-1"><span>${label}</span><span>${fY(val)} (${pct}%)</span></div>
        <div class="h-3 bg-gray-700 rounded-full"><div class="h-full rounded-full" style="width:${pct}%;background:${color}"></div></div>
      </div>`;
    }

    // Start
    render();
  </script>
</body>
</html>
